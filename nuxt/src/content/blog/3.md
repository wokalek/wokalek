---
createdAt: 2023-07-27T22:22:22+03:00
---

Запилил небольшой проектик по билду сервера Nginx'а и хочу про него рассказать. Данный сайт работает на нём.

[github.com/wokalek/nginx-brotli](https://github.com/wokalek/nginx-brotli) :emoji{text="✌️"}

Изначально всё, что я хотел, это подрубить поддержку [HTTP3/QUIC](https://ru.wikipedia.org/wiki/HTTP%2F3?useskin=vector) для своего сайтика, потому что концепция работы HTTP3 [реально крутая](https://habr.com/ru/companies/globalsign/articles/560342/):

![Работа протокола QUIC](/static/blog/quic-work.png){width="997" height="536"}

Но я недооценил кривость этой технологии в её текущем состоянии — «я ограничен технологиями своего времни».

Я использовал другие изображения Docker'а для HTTP3, спустя полтора дня безвылозного вдупления в сборку nginx — сбилдил свой собственный nginx с nginx-brotli и http3, и результат был неутешительный, потому что всё лагало, тормозило, некоторые запросы просто вешались.

Вообщем, пока рано миру видеть HTTP3.

Тем не менее я решил запилить собственную сборку nginx и вырожить её в свою репу.

Плюсы у неё тоже есть. Например то, что самый популярный образ `fholzer/nginx-brotli` с 1 миллионом пулов — 13,96 МБ, а `wokalek/nginx-brotli` — **9,36 МБ** (при сжатии gzip, сравнивая теги 1.25.1 обоих образов).

И, например, такой немаловажный момент, как, например, читаемость Dockerfile'а, чего просто отсутствует у *всех* других образов.

А также отсутствие кучи другой фигни типа поддержки перла, луа, прочей никому ненужных настроек, но присутствие реально важных настроек.

### Будущее

Я постараюсь когда-нибудь сделать автобилд по расписанию новых образов при выходе новых версий nginx и его зависимых библиотек.

Ну и будет интересно посмотреть, как и когда допилят нормальную поддержку HTTP3/QUIC. Билд версии с использованием OpenSSL, с поддержкой QUIC, уже доступен в ветке [http3](https://github.com/wokalek/nginx-brotli/tree/http3). Но если это реально кто-то читает, то спешупредупредить, это супер эксперементальная штука и *не надо* ей пока пользоваться.
